This is a coding assignment.
I think I had a bit too much fun with it.
If I did not add a custom beanfactory mockup class for testing I could have probably done it faster.
The SubscriptionController.php contains the asked for function. The rest is boilerplate to make it work.